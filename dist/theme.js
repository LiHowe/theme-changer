"use strict";var e,t;!function(e){e[e.ROOT_CSS=0]="ROOT_CSS",e[e.STRING_TEMPLATE=1]="STRING_TEMPLATE",e[e.LINK_TAG=2]="LINK_TAG"}(e||(e={})),function(e){e[e.LOCAL_STORAGE=0]="LOCAL_STORAGE",e[e.DOM=1]="DOM",e[e.HEAP=2]="HEAP"}(t||(t={}));class i{constructor(s){if(this.defaultColor={default:{primary:"#EC6300"}},this.styleSheetCache=new Map,this.defaultOption={type:e.ROOT_CSS,colorDefine:this.defaultColor,cache:!0,cacheType:t.DOM,mountTarget:"head",idPrefix:"--theme-"},this.options=this.defaultOption,this.__dev__=!!process&&"production"!==process.env.NODE_ENV,this.themeName="",this.formattedThemeName="",this.type=e,this.cacheType=t,this.getStyleElementByThemeName=(e,t=!1)=>{let i=document.querySelector(`#${this.options.idPrefix}${e}`);return i||(this.styleSheetCache.get(e)?this.styleSheetCache.get(e)||null:(t&&this.generateStyleElement(e),null))},this.generateStyleElement=e=>{const t=this.getCachedStyleElement(e);if(t)return t;const i=document.createElement("style");return i.id=this.options.idPrefix+e,i.innerHTML=this.generateStyleContent(e),i},this.generateRootVariable=e=>{if(!this.options.colorDefine)throw new Error("You must define theme color in ROOT_CSS mode");Object.keys(this.options.colorDefine[e]).forEach((t=>{this.options.colorDefine&&this.options.colorDefine[e]&&document.documentElement.style.setProperty("--"+t,this.options.colorDefine[e][t])}))},this.generateLinkTag=()=>{if(this.options.styleLinkMap){const e=document.createDocumentFragment();this.options.styleLinkMap.forEach(((t,i)=>{const s=document.createElement("link");s.href=t,s.rel="preload",s.as="style",s.id=this.getFormattedThemeName(i),e.appendChild(s)})),document.head.appendChild(e)}},this.deleteStyleElement=(e,t)=>{if(t)return void document[this.options.mountTarget].removeChild(t);const i=document.querySelector(`#${this.options.idPrefix}${e}`);i&&document[this.options.mountTarget].removeChild(i)},this.activeStyleSheet=e=>{this.options.cache&&e.hasAttribute("is-cache")?e.disabled=!1:document[this.options.mountTarget].appendChild(e)},this.generateStyleContent=e=>{if(!this.options.templateGenerator)throw new Error("The template generator is not set");return this.options.templateGenerator(e)},this.cacheStyleElement=(e,t)=>{const i=this.getFormattedThemeName(e);if(t||(t=document.querySelector("#"+i)))switch(this.options.cacheType){case this.cacheType.DOM:t.disabled=!0,t.setAttribute("is-cache","");break;case this.cacheType.HEAP:!this.styleSheetCache.has(i)&&this.styleSheetCache.set(i,t);break;case this.cacheType.LOCAL_STORAGE:if(!window.localStorage)throw new Error("Your browser not support localStorage, please choose another cache type.");window.localStorage.setItem(i,JSON.stringify({id:t.id,content:t.innerHTML}))}},this.getCachedStyleElement=e=>{switch(this.options.cacheType){case this.cacheType.DOM:return document.querySelector("#"+this.getFormattedThemeName(e));case this.cacheType.HEAP:return this.styleSheetCache.get(this.getFormattedThemeName(e))||null;case this.cacheType.LOCAL_STORAGE:const t=window.localStorage.getItem(this.getFormattedThemeName(e));if(!t)return null;const i=JSON.parse(t),s=document.createElement("style");return s.innerHTML=i.content,s.id=i.id,s;default:return null}},this.clearCache=()=>{switch(this.options.cacheType){case this.cacheType.DOM:document.querySelectorAll("style[cache]").forEach((e=>{this.deleteStyleElement("",e)}));break;case this.cacheType.HEAP:this.styleSheetCache.clear();break;case this.cacheType.LOCAL_STORAGE:Object.keys(window.localStorage).forEach((e=>{e.startsWith(this.options.idPrefix)&&window.localStorage.removeItem(e)}));break;default:return}},this.getFormattedThemeName=e=>`${this.options.idPrefix}${e}`,this.getRawThemeName=e=>this.options.idPrefix&&e.startsWith(this.options.idPrefix)?e.split(this.options.idPrefix)[1]:e,this.getOptions=()=>this.options,this.setOption=e=>(i.theme=new i(Object.assign(this.options,e)),i.theme),this.setTemplateGenerator=e=>{this.options.templateGenerator=e},this.getCurrentTheme=()=>this.themeName,this.changeTheme=t=>{switch(t&&(this.options.cache?this.cacheStyleElement(this.themeName):this.deleteStyleElement(this.themeName)),this.themeName=t,this.options.type){case e.ROOT_CSS:this.generateRootVariable(t);break;case e.STRING_TEMPLATE:this.activeStyleSheet(this.generateStyleElement(t));break;case e.LINK_TAG:this.generateLinkTag()}},this.__dev__){if(!s)return;s.type===e.ROOT_CSS&&console.warn("IE browser not support this type, please use 'stringTemplate' to instead of it")}this.options=Object.assign(this.defaultOption,s)}}i.getInstance=e=>(i.theme||(i.theme=new i(e)),i.theme.__dev__&&window&&(window.__theme=i.theme),i.theme.options.changeWhenInit&&i.theme.changeTheme(i.theme.options.changeWhenInit),i.theme);var s,o=i.getInstance(s);module.exports=o;
